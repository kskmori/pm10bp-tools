#!/bin/sh

refstatus=backport-1.0-status
refmemo=backport-1.0-memo

limittag=Pacemaker-1.1.6

usage() {
  echo "usage: $0 [-l|t|n] [-h]"
  echo "    -l: print all backport status"
  echo "    -t: print commits to be applied"
  echo "    -n: print commits not determined"
  echo "    -h: print usage"
  exit 1;
}

FILTER="cat"
while getopts "ltnh" opt; do
  case $opt in
    l) FILTER="grep ^\(TBA\|DONE\|PEND\|REJ\)";;
    t) FILTER="grep ^TBA";;
    n) FILTER="grep ^,";;
    h) usage;;
  esac
done

shift $(($OPTIND - 1))

git log --topo-order -C -M --pretty=format:'%N,<%h>,%ad,"%s"' --date=short --show-notes=$refstatus $limittag.. | awk '/^STATUS:/ { printf("%s", $2); next } { print }' | $FILTER


